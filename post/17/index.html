<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Google Map 中获取兴趣点 （POI） 信息 - ORIGAE,Tinypress">
    <meta name="description" content="Google Map 中获取兴趣点 （POI） 信息,Tinypress" />
    <title>Google Map 中获取兴趣点 （POI） 信息 - ORIGAE</title>
    <link href="/styles/main.css" rel="stylesheet" />
</head>
<body>
    <header class="head">
        <h1 class="head-title u-fl"><a href="/">ORIGAE</a></h1>
        <nav class="head-nav u-fr">
            <ul class="head-nav__list">
                
            </ul>
        </nav>
    </header>
    <main class="main"><article class="post">
    <header class="post__head">
        <h1 class="post__title"><a href="/post/17">Google Map 中获取兴趣点 （POI） 信息</a></h1>
        <p datetime="5/28/2018 11:03:00 PM" class="post__time">5/28/2018 11:03:00 PM</p>
    </header>
    <div class="post__main echo">
        <p>首先来说，Google Map 的集成其实非常简单，如果使用了 Google Play Service 了可能就几行代码调用的事，不过在我集成的过程中，发现虽然基于 Service SDK 的集成虽然简单，但是功能少了很多，比如基于 POI 信息获取的方法函数中，就没有传递半径区域的方法，这就需要使用到 Places API Web Service 了。</p>
<p>打开<a href="https://developers.google.cn/places/web-service/?hl=zh-cn">官方文档</a>主页，就已经是 POI 应用的一个实例了。</p>
<p><img src="/images/2018_5_636631454052910160.png" alt="" /></p>
<p>可以看到需要传递的参数包括当前坐标，搜索区域半径，POI 类型，关键字等，以及需要申请一个 APP KEY，这个很简单，在开发者控制台申请好就行。</p>
<p>设计到 WebAPI 的调用，在 Android 上有很多可选的网络请求方案，上 Github 搜索 HTTP，然后按照 Start 倒序一排，这就是我说的面向 Github 编程。</p>
<p>我们选择  <a href="https://github.com/square/retrofit">Retrofit</a> 这个就行了，OkHttp 可以不用看了，不是说它不好，只是封装的还不够友好，Retrofit 是把 OkHttp 和 RxJava 糅到一起，使 OkHttp 更为丝滑。在这之前我一直是用 <a href="https://github.com/loopj/android-async-http">android-async-http</a>，这个 Http 库也是非常强大。</p>
<p>对于任何 Http 框架，由于我们最终返回的是 Json，所以需要实体类，当然面对这一堆 Json 我们没必要自己去写实体类，网上已经有很多 Json 转 Javabean 的工具了。</p>
<p><img src="/images/2018_5_636631454135852580.png" alt="" /></p>
<p>在项目中集成 Retrofit 非常简单：</p>
<pre><code> implementation 'com.squareup.retrofit2:retrofit:2.4.0'
</code></pre>
<p>然后把生成的 Bean 导入项目，并编写 API 调用接口：</p>
<pre><code>public interface GoogleMapApi {

    @GET(&quot;/maps/api/place/nearbysearch/json&quot;)
    Call&lt;GooglePoiBean&gt; listRepos(@Query(&quot;location&quot;) String location,
                                  @Query(&quot;radius&quot;) int radius,
                                  @Query(&quot;types&quot;) String types,
                                  @Query(&quot;name&quot;) String name,
                                  @Query(&quot;key&quot;) String key);

}
</code></pre>
<p>然后创建一个服务主调用类，因为如果接口多了，还可以方便统一管理。</p>
<pre><code>public class GoogleAPIService {

    private static final String GOOGLE_SERVICE_API_KEY  = &quot;AIzaSyBP6nc-FJl7xZtZJP3dTXxeCNr7lWaM3yM&quot;;

    private Retrofit retrofit;

    public GoogleAPIService() {

        retrofit = new Retrofit.Builder()
                .baseUrl(&quot;https://maps.googleapis.com/&quot;)
                .build();

    }

    public void getPoi(double lat, double lng, int radius, String type, Callback&lt;GooglePoiBean&gt; callback) {

        GoogleMapApi googleMapApi = retrofit.create(GoogleMapApi.class);
        Call&lt;GooglePoiBean&gt; googlePoiBeanCall = googleMapApi.listRepos(lat + &quot;,&quot; + lng, radius, type, &quot;&quot;, GOOGLE_SERVICE_API_KEY);
        googlePoiBeanCall.enqueue(callback);

    }
}
</code></pre>
<p>调用非常简单，调用如下：</p>
<pre><code> GoogleAPIService googleAPIService = new GoogleAPIService();
 googleAPIService.getPoi(30.223, 114.232, 20000, &quot;酒店&quot;, new Callback&lt;GooglePoiBean&gt;() {
     @Override
     public void onResponse(Call&lt;GooglePoiBean&gt; call, Response&lt;GooglePoiBean&gt; response) {
     }
     @Override
     public void onFailure(Call&lt;GooglePoiBean&gt; call, Throwable t) {
     }
 });
</code></pre>
<p>至此，就已经实现了 Google Map WebService API 的 POI 功能集成了，就算没有 Play Service ，这个功能还是能正常使用的，前提是能访问 Google Map 服务了，不过，国内好像都不能访问的，我也不太清楚什么原因，如果你知道，可以告诉我 。→_→</p>

    </div>
</article></main>
    <footer class="foot">
        <div class="foot-copy u-fl">© 2018 ORIGAE&nbsp;&nbsp;|&nbsp;&nbsp; POWERED BY TiNYFX</div>
        <menu class="page-menu u-fr">
            
            
        </menu>
    </footer>
</body>
</html>
