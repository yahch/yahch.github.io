<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="在Android上使用微信开源数据库框架WCDB - ORIGAE,Tinypress">
    <meta name="description" content="在Android上使用微信开源数据库框架WCDB,Tinypress" />
    <title>在Android上使用微信开源数据库框架WCDB - ORIGAE</title>
    <link href="/styles/main.css" rel="stylesheet" />
</head>
<body>
    <header class="head">
        <h1 class="head-title u-fl"><a href="/">ORIGAE</a></h1>
        <nav class="head-nav u-fr">
            <ul class="head-nav__list">
                
            </ul>
        </nav>
    </header>
    <main class="main"><article class="post">
    <header class="post__head">
        <h1 class="post__title"><a href="/post/20">在Android上使用微信开源数据库框架WCDB</a></h1>
        <p datetime="5/28/2018 11:07:03 PM" class="post__time">5/28/2018 11:07:03 PM</p>
    </header>
    <div class="post__main echo">
        <p>WCDB 是腾讯出品的一个高效、完整、易用的移动数据库框架，基于SQLCipher，支持iOS, macOS和Android，还内建了Repair Kit用于修复损坏的数据库以及内置的防SQL注入。</p>
<blockquote>
<p>项目地址：https://github.com/Tencent/wcdb</p>
</blockquote>
<p>使用方法：</p>
<pre><code>dependencies {
    compile 'com.tencent.wcdb:wcdb-android:1.0.2'
    // Replace &quot;1.0.2&quot; to any available version.
}
</code></pre>
<p>和在 android 上使用 SQLite 一样，先创建一个 WcdbHelper 继承 SQLiteOpenHelper 类，注意包名这里是 com.tencent.wcdb.database 。</p>
<pre><code>class WcdbHelper extends SQLiteOpenHelper{
    public WcdbHelper(Context context, String name, byte[] password, SQLiteDatabase.CursorFactory factory, int version, DatabaseErrorHandler errorHandler) {
        super(context, name, password, factory, version, errorHandler);
    }
    @Override
    public void onCreate(SQLiteDatabase db) {
    }
    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
    }
}
</code></pre>
<p>由于 wcdb 是基于 SQLCipher，所以我们可以为数据库设置一个密码，我们在构造函数里指定密码即可，wcdb 允许 byte[] 作为密码， SQLCipher 使用 String 作为密码。</p>
<pre><code>File cdb = new File(getExternalFilesDir(&quot;db&quot;), &quot;hello.wcdb&quot;);
WcdbHelper wcdbHelper = new WcdbHelper(
        getApplicationContext(),
        cdb.getAbsolutePath(),
        &quot;password&quot;.getBytes(), null, 1, null
);
</code></pre>
<p>接下来在这张表里创建一条数据：</p>
<pre><code>String sql = &quot;INSERT INTO \&quot;main\&quot;.\&quot;address_book\&quot; (\&quot;name\&quot;, \&quot;age\&quot;, \&quot;address\&quot;) VALUES (?, ?, ?)&quot;;
wcdbHelper.getWritableDatabase().execSQL(sql, new String[]{&quot;dummy&quot;, &quot;28&quot;, &quot;Hubei wuhan&quot;});
</code></pre>
<p>这样，在 hello.wcdb 这个数据库中就存在了一条数据，当我们像打开 sqlite 数据库时打开这个 wcdb 数据库时候，提示错误，这是正常的，因为它被加密了，这样无论手机是否 root 或是我们把数据库存放在外置存储中，对于我们 app 的敏感数据来说，他们依然是安全的。</p>
<p><img src="/images/2018_5_636631456464424410.png" alt="" /></p>
<p>总得来说，如果会使用 sqlite 的话，那么 wcdb 也不在话下，并且迁移成本也很小。唯一的不足是，wcdb 官方提到的 winq 查询在 android 上并不支持，但是官方也说在今后会提供其他方式的 orm 以方便数据库操作。</p>
<p>对于习惯了像 .NET 上的 EF 框架的人来说说，在 app 或程序中继续写 sql 语句让我回到了刀耕火种的时代，在 wcdb 之前我接触到的另一个数据库是 .NET 平台上的 LiteDB，虽然它不出名，但是不用让我写 sql ，虽然它本就是 NoSQL 数据库 ，哈！</p>

    </div>
</article></main>
    <footer class="foot">
        <div class="foot-copy u-fl">© 2018 ORIGAE&nbsp;&nbsp;|&nbsp;&nbsp; POWERED BY TiNYFX</div>
        <menu class="page-menu u-fr">
            
            
        </menu>
    </footer>
</body>
</html>
